name: roc-config
control:
  mode: basic
wants:
  cpu: 0.2
  memory: 256
defaults:
  rocConfigLinks: "#0"
  rocConfigAllowRejection: "false"
  rocConfigClock: "local"
  rocConfigCruId: "0x0"
  rocConfigDatapathMode: "packet"
  rocConfigDownstreamData: "ctp"
  rocConfigGbtMode: "gbt"
  rocConfigGbtMux: "ttc"
  rocConfigLoopback: "false"
  rocConfigPonUpstream: "false"
  rocConfigDynOffset: "false"
  rocConfigOnuAddress: "0"
  rocConfigForceConfig: "false"
  rocConfigBypassFwCheck: "false"
  rocConfigTriggerWindowSize: "1000"
command: 
  shell: true
  value: >-
    source /etc/profile.d/modules.sh &&
    MODULEPATH=/opt/alisw/el7/modulefiles module load ReadoutCard &&
    roc-config
  arguments:
    - "--id"
    - "{{ rocConfigId }}"
    - "--links"
    - "{{ rocConfigLinks }}"
    - "{{ rocConfigAllowRejection == 'true' ? '--allow-rejection' : '' }}"
    - "--clock"
    - "{{ rocConfigClock }}"
    - "--cru-id"
    - "{{ rocConfigCruId }}"
    - "--datapathmode"
    - "{{ rocConfigDatapathMode }}"
    - "--downstreamdata"
    - "{{ rocConfigDownstreamData }}"
    - "--gbtmode"
    - "{{ rocConfigGbtMode }}"
    - "--gbtmux"
    - "{{ rocConfigGbtMux }}"
    - "{{ rocConfigLoopback == 'true' ? '--loopback' : '' }}"
    - "{{ rocConfigPonUpstream == 'true' ? '--pon-upstream' : '' }}"
    - "{{ rocConfigDynOffset == 'true' ? '--dyn-offset' : '' }}"
    - "--onu-address"
    - "{{ rocConfigOnuAddress }}"
    - "{{ rocConfigForceConfig == 'true' ? '--force-config' : '' }}"
    - "{{ rocConfigBypassFwCheck == 'true' ? '--bypass-fw-check' : '' }}"
    - "--trigger-window-size"
    - "{{ rocConfigTriggerWindowSize }}
