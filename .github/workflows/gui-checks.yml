name: GUIChecks
on:
  pull_request:
    paths:
      - 'tasks/*'
      - 'workflows/*'
  push:
    branches:
      - 'master'
env:
  LIST_OF_VARIABLES: dcs_enabled\|trg_enabled\|epn_enabled\|odc_topology\|odc_enabled\|qcdd_enabled\|dd_enabled\|ddsched_enabled\|minimal_dpl_enabled\|readout_cfg_uri\|qc_config_uri
jobs:
  # tasks-directory-check:
  #   name: Checks no changes to fix variables are done in tasks directory
  #   runs-on: macOS-latest
  #   env:
  #     RESULT_TASKS: ''
  #   steps:
  #     - uses: actions/checkout@v2
  #       with:
  #           path: ControlWorkflows
  #     - run: (echo "Checks will be ran against branch  ${{ github.ref }}")
  #     - name: Run GUI variables checks for TASKS
  #       working-directory: ./ControlWorkflows
  #       run: |
  #         RESULT_TASKS=$(grep $LIST_OF_VARIABLES ./tasks/*.yaml)
  #     - name: Check results of grep commands
  #       run: |
  #         if [ -z "$RESULT_TASKS" ];
  #         then
  #           echo "TASKS folder did not find any breaking changes"
  #         else 
  #           echo "TASKS folder found breaking changes. Please inform GUI Developer"
  #           exit 1
  #         fi
  workflows-directory-check:
    name: Checks no changes are done to fix variables in workflow directory
    runs-on: macOS-latest
    env:
      RESULT_WORKFLOWS: ''
    steps:
      - uses: actions/checkout@v2
        with:
            path: ControlWorkflows
      - run: (echo "Checks will be ran against branch ${GITHUB_HEAD_REF}")
      - run: (git checkout ${GITHUB_HEAD_REF})
      - run: (git checkout ${GITHUB_BASE_REF})
      - name: Run GUI variables checks for WORKFLOWS
        working-directory: ./ControlWorkflows
        run: |
          DIFF_CHANGES=$(git diff $GITHUB_BASE_REF $GITHUB_HEAD_REF)
          echo $DIFF_CHANGES
          echo "CHANGES_ABOVE"
          RESULT_WORKFLOWS=$(grep -nr env.LIST_OF_VARIABLES <<<$DIFF_CHANGES)
          echo $RESULT_WORKFLOWS
          echo "RESULT_CHANGES_ABOVE"
      - name: Check results of grep commands
        run: |
          if [ -z "$RESULT_WORKFLOWS" ];
          then
            echo "WORKFLOWS folder did not find any breaking changes"
          else 
            echo "WORKFLOWS folder found breaking changes. Please inform GUI Developer"
            exit 1
          fi
